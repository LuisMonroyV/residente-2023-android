<ion-header class="ion-no-border mt-40" [translucent]="true">
  <ion-toolbar>
    <ion-title>Solicitud de reserva</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cerrarModal()"
                  color="danger"
                  >
        Cerrar
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <form (ngSubmit)="guardarReserva()"
        novalidate="novalidate"
        #formReserva="ngForm">
    <ion-card>
      <ion-list>
        <div *ngIf="paso === 1">
          <ion-item lines="none">
            <span class="tam-14">Primero selecciona la fecha</span>
          </ion-item>
          <ion-item>
            <ion-grid fixed>
              <ion-row *ngFor="let dia of fechasDisponibles; let i = index">
                <ion-col class="ion-no-padding">
                  <ion-chip color="primary" mode="ios" outline="true" (click)="recalculaMinMax(i)"
                            class="grilla"
                            [ngClass]="{'seleccionado': fbSrvc.soloFecha(this.nuevaReserva.fechaInicioReserva) == fbSrvc.soloFecha(dia)}">
                    <ion-label  class="tam-20" [ngClass]="{'feriado': fbSrvc.esFeriado(dia)}">{{dia | date : 'EEE dd-MMM' | titlecase }}</ion-label>
                  </ion-chip>
              </ion-col>
            </ion-row>
          </ion-grid> 
          </ion-item>
          <ion-item>
            <ion-button (click)="cerrarModal()"
                        class="btn-anterior"
                        fill="outline"
                        >
              Anterior
            </ion-button>
            <ion-button (click)="siguiente()" 
                        class="btn-siguiente"
                        [disabled]="!formReserva.valid || !fechaSeleccionada">
              Siguiente
            </ion-button>
          </ion-item>
        </div>
        <div *ngIf="paso === 2">
          <ion-item lines="none" class="ion-text-center">
            <ion-chip color="primary" mode="ios">
              <ion-label class="tam-20">{{nuevaReserva.fechaInicioReserva | date : 'EEE dd-MMM' | titlecase }}</ion-label>
            </ion-chip>
          </ion-item>
          <ion-item lines="none">
            <span class="tam-14">Ahora selecciona el horario</span>
          </ion-item>
          <ion-item *ngIf="horariosDisponibles.length === 0" class="ion-text-center" lines="none">
            <span><h1 color="warning">No hay horarios disponibles para esta fecha.</h1></span>
          </ion-item>
          <ion-item> 
            <ion-row>
              <ion-col *ngFor="let hora of horariosDisponibles; let i = index" class="ion-text-center">
                <ion-chip color="primary" mode="ios" outline="true" (click)="seleccionaHora(i)"
                          [ngClass]="{'seleccionado': fbSrvc.soloHora(nuevaReserva.fechaInicioReserva) == fbSrvc.soloHora(hora)}">
                  <ion-label class="tam-20">{{hora | date : 'HH:mm'}} a {{sumarMinutos(hora) | date : 'HH:mm'}}</ion-label>
                </ion-chip>
              </ion-col>
            </ion-row>
          </ion-item>
          <ion-item lines="none">
            <ion-button (click)="anterior()" 
                        class="btn-anterior"
                        fill="outline">
              Anterior
            </ion-button>
            <ion-button (click)="siguiente()" 
                        class="btn-siguiente"
                        [disabled]="!formReserva.valid || !horaSeleccionada">
              Siguiente
            </ion-button>
          </ion-item>
        </div>
        <div *ngIf="paso === 3" id="paso3">
          <ion-item lines="none" class="ion-text-center">
            <ion-chip color="primary" mode="ios">
              <ion-label class="tam-20">{{nuevaReserva.fechaInicioReserva | date : 'EEE dd-MMM' | titlecase }}</ion-label>
            </ion-chip>
            <ion-chip color="primary" mode="ios">
              <ion-label class="tam-20">de {{nuevaReserva.fechaInicioReserva | fechaCorta : 'HH:mm' : ''}} a {{nuevaReserva.fechaFinReserva | fechaCorta : 'HH:mm' : ''}}</ion-label>
            </ion-chip>
          </ion-item>
          <ion-item lines="none" class="py-10">
            <span class="tam-14">Finalmente agrega una descripción de la actividad e indica si requieres implementos. </span>
          </ion-item>
          <ion-item lines="none"> 
            <ion-row>
              <ion-col>
                <ion-label color="primary" position="stacked">Descripción: </ion-label>
                <ion-textarea [(ngModel)]="nuevaReserva.obsResid"
                              name="observaciones"
                              required
                              id="desc"
                              #descripcion
                              spellcheck = "true"
                              >
                </ion-textarea>  
              </ion-col>
            </ion-row>
          </ion-item>
          <ion-item lines="none" class="ion-text-center">
            <ion-button (click)="anterior()" 
                        fill="outline" 
                        class="btn-anterior">
              Anterior
            </ion-button>
            <ion-button type="submit"
                        [disabled]="!formReserva.valid || !horaSeleccionada || !fechaSeleccionada"
                        class="btn-siguiente"
                        >
              Guardar Cambios
            </ion-button>
            <ion-ripple-effect type="bounded"></ion-ripple-effect>
          </ion-item>
        </div>
      </ion-list>  
    </ion-card>
  </form>
</ion-content>
