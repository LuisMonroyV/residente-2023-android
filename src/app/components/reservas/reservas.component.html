<ion-content>
  <ion-segment *ngIf="fbSrvc.persona.esAdminCancha"
              (ionChange)="segmentChanged($event)" 
              mode="ios"
              color="secondary"
              value="calendario">
    <ion-segment-button value="calendario">
      <ion-label>Calendario</ion-label>
    </ion-segment-button>
      <ion-segment-button value="solicitudes">
      <ion-label>Solictudes
        <ion-badge *ngIf="solictudesCanchaPendientes.length > 0" 
                  color="success" 
                  mode="ios">
          {{solictudesCanchaPendientes.length}}
        </ion-badge>
      </ion-label>
    </ion-segment-button>
  </ion-segment>
  <!-- Sección Calendario -->
  <div *ngIf="seccion === 'calendario'">
    <div class="ion-padding ion-text-center borde" >
      <ion-chip color="whatsapp-green" mode="ios" outline="false" class="borde-chip">
        <ion-label style="color: white;">Disponible</ion-label>
      </ion-chip>
      <ion-chip color="warning" mode="ios" outline="false" class="borde-chip">
        <ion-label>Solicitada</ion-label>
      </ion-chip>
      <ion-chip color="primary" mode="ios" outline="false" class="borde-chip">
        <ion-label>Reservada</ion-label>
      </ion-chip>
    </div>
    <ion-grid fixed class="borde-horario" *ngIf="semana && semana.length > 0">
      <ion-row >
        <ion-col *ngFor="let diaSem of semana; let d = index"  class="centrado ion-no-padding">
          <ion-row class="borde-azul ion-no-padding  ion-text-center" >
            <ion-col class="ion-no-padding ion-text-center">
              <span [ngClass]="{'feriado': fbSrvc.esFeriado(diaSem.dia)}" class="tam-14">{{(diaSem.dia | date: 'EEE') | titlecase }}</span> <br>
              <strong class="tam-16" [ngClass]="{'feriado': fbSrvc.esFeriado(diaSem.dia)}">{{(diaSem.dia | date: 'dd') | titlecase }}</strong>
            </ion-col>
          </ion-row>
          <ion-row *ngFor="let hora of diaSem.horas; let h = index" class="centrado"
                  [ngClass]="{'solicitada': hora.reserva.estado === 'Solicitada', 
                              'reservada': hora.reserva.estado === 'Reservada', 
                              'disponible': hora.reserva.estado === 'Disponible'}"
                  >
            <span class="tam-14" (click)="alertaReserva()">{{hora.hora| date: 'HH:mm'}}</span>
          </ion-row>
        </ion-col>    
      </ion-row>
    </ion-grid>
    <ion-grid fixed class="borde-horario">
      <ion-row class="centrado-flex">
        <ion-col class="centrado-flex">
          <span class="tam-20">Mis reservas</span>
        </ion-col>
      </ion-row>
      <div *ngIf="misReservasSemana && misReservasSemana.length > 0">
        <ion-row *ngFor="let reserva of misReservasSemana; let i = index" class="card-reservas">
          <ion-card [ngClass]="{'solicitada': reserva.estado === 'Solicitada', 
                                'reservada': reserva.estado === 'Reservada', 
                                'rechazada': reserva.estado === 'Disponible'}">
            <ion-card-content  class="ion-no-padding">
              <ion-grid fixed>
                <ion-row>
                  <ion-col size="10" class="tam-15">
                    <ion-chip mode="ios">
                      <ion-label>{{reserva.fechaSolicitud | fechaCorta : '' : 'pasado'}}</ion-label>
                    </ion-chip>
                    <ion-chip mode="ios"
                              [ngClass]="{'solicitada': reserva.estado === 'Solicitada', 
                                          'reservada': reserva.estado === 'Reservada', 
                                          'rechazada': reserva.estado === 'Disponible'}">
                      <ion-label>{{reserva.estado === 'Disponible' ? 'Rechazada' : reserva.estado}}</ion-label>
                    </ion-chip><br>
                    <ion-label>Para el: {{reserva.fechaInicioReserva | date : 'dd-MMM'}} de {{reserva.fechaInicioReserva | date : 'HH-mm'}} a {{reserva.fechaFinReserva | date : 'HH-mm'}}</ion-label> <br>
                    <ion-label>Actividad: {{reserva.obsResid}}</ion-label><br>
                    <ion-label *ngIf="reserva.obsAdmin.length > 0">Obs. Admin.: {{reserva.obsAdmin}}</ion-label>
                  </ion-col>
                  <ion-col size="2" class="centrado pt-40">
                    <ion-icon name="trash-outline"
                              color="danger"
                              (click)="anular(i)"
                              size="large"
                              >
                    </ion-icon>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-card-content>
          </ion-card>
        </ion-row>
      </div>
      <div *ngIf="!misReservasSemana || misReservasSemana.length === 0"
            class="ion-text-center"
            >
        <img class="ion-padding" src="assets/images/no-data-10.png"/>
      </div>
    </ion-grid>
  </div>
  <!-- Sección Solicitudes -->
  <div *ngIf="seccion === 'solicitudes'">
    <div *ngIf="solictudesCanchaPendientes.length > 0">
      <ion-list #listaPendientes>
        <ion-item-sliding *ngFor="let solicitud of solictudesCanchaPendientes">
          <ion-item lines="none" class="ion-no-padding">
            <ion-card class="card-solicitudes ion-no-padding" color="light">
              <ion-card-header>
                <ion-badge style="float: right;" color="warning">{{ solicitud.fechaSolicitud | fechaCorta : '' : 'pasado'}}</ion-badge>
                <ion-badge style="float: left;" color="primary">{{ solicitud.idDireccion }}</ion-badge>
                <br>
              </ion-card-header>
              <ion-card-content>
                <p><ion-text color="primary"> Para el día: </ion-text>{{ solicitud.fechaInicioReserva | fechaCorta : 'dddd DD-MMM-YYYY' : '' }}</p>
                <p><ion-text color="primary"> De: </ion-text>{{ solicitud.fechaInicioReserva | fechaCorta : 'HH:mm' : '' }}
                   <ion-text color="primary"> a: </ion-text>{{ solicitud.fechaFinReserva | fechaCorta : 'HH:mm' : '' }} </p>
                <p>
                  <ion-text color="primary"> Actividad: </ion-text>{{ solicitud.obsResid ?  solicitud.obsResid : 'Sin especificar'}}
                  <a href="https://wa.me/{{solicitud.contacto}}" target="_blank" style="float: inline-end;">
                    <ion-icon name="logo-whatsapp"
                              slot="icon-only"
                              color="whatsapp-green"
                              size="large"
                              >
                    </ion-icon>
                  </a>
                </p>
              </ion-card-content>
            </ion-card>
          </ion-item>
          <ion-item-options side="start">
            <ion-item-option color="primary"
                             (click)="aprobar(solicitud)"
                             >
              <ion-icon name="thumbs-up-sharp"
                        slot="icon-only"
                        size="large"
                        >
              </ion-icon>
            </ion-item-option>
          </ion-item-options>
  
          <ion-item-options side="end">
            <ion-item-option color="danger"
                             (click)="rechazar(solicitud)"
                             >
              <ion-icon name="thumbs-down-sharp"
                        slot="icon-only"
                        size="large"
                        >
              </ion-icon>
            </ion-item-option>
          </ion-item-options>
        </ion-item-sliding>
      </ion-list>
    </div>
    <div *ngIf="solictudesCanchaPendientes.length === 0"
         class="ion-text-center"
         style="padding-top: 50%;"
         >
      <img class="ion-padding" src="assets/images/no-data-10.png"/>
    </div>

  </div>
</ion-content>
<div *ngIf="seccion === 'calendario'">
  <ion-fab vertical="center" horizontal="end" slot="fixed">
    <ion-fab-button (click)="solicitar()">
        <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>  
</div>
